{% extends 'base.html' %}
{% load static %} 
{% block content %}
<!-- HOME -->
<section class="section-hero overlay inner-page bg-image" style="background-image: url('{% static 'images/bgrr.jpg' %}');" id="home-section">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">{{ applicant.get_full_name }}</h1>
        <div class="custom-breadcrumbs">
          <a href="{% url 'jobapp:home' %}">Home</a> <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Applicant</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="site-section block__18514" id="next-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="border p-4 rounded">
          <ul class="list-unstyled block__47528 mb-0">
            <li><span class="active">Applicant</span></li>
            <li><a href="#">Topic 1</a></li>
            <li><a href="#">Topic 2</a></li>
          </ul>
        </div>
      </div>
      
      <div class="col-lg-5">
              
        <h3 class="mb-4">{{ applicant.get_full_name }}</h3>
        <span class="text-primary d-block mb-6" style="width: 300px; height: 300px; overflow: hidden; border-radius: 50%;">
          <img src="{{ applicant.photo.url }}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover;">
      </span>
      
        <p><h3>Email :</h3>{{ applicant.email }}</p>
        <p><h3>Phone Number :</h3><a href="tel:+977{{ applicant.phone_number }}">+977 {{ applicant.phone_number }}</a></p>
        
        <p><h3>Gender :</h3>
            {% if applicant.gender == 'M' %}
                Male
            {% else %}
                Female
            {% endif %}
        </p>
        <div class="d-flex">
              <button type="button" class="btn btn-success btn-md mt-4 mr-2" data-toggle="modal" data-target="#emailPositionModal" onclick="setButtonType('select')">Select</button>
              <button type="button" class="btn btn-danger btn-md mt-4" data-toggle="modal" data-target="#emailPositionModal" onclick="setButtonType('reject')">Reject</button>
          </div>
      </div>
      <div class="col-lg-3">
        <div class="border p-4 rounded">
            <h2>Resume:</h2>
            {% if applicant.pdf_document %}
                <div class="row">
                  <div class="col-md-6 mt-2 ">
                    <a href="{{ applicant.pdf_document.url }}" target="_blank" >
                      <i class="fa-regular fa-eye fa-beat fa-2xl ml-4" style="color: #000000;"></i>
                    </a>
                </div>
                <div class="col-md-6 mt-2">
                    <a href="{{ applicant.pdf_document.url }}" download="resume.pdf" >
                      <i class="fa-sharp fa-solid fa-download fa-bounce fa-2xl" style="color: #000000;"></i>
                    </a>
                </div>
                
            {% else %}
                <p>No PDF Available</p>
            {% endif %}
        </div>
    </div>
    
    
        
    </div>
  </section>
  
<!-- Modal -->
<div class="modal fade" id="emailPositionModal" tabindex="-1" role="dialog" aria-labelledby="emailPositionModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="emailPositionModalLabel">Enter Email and Position</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="emailPositionForm">
    
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" required>
          </div>
          <div class="form-group">
            <label for="position">Position:</label>
            <input type="text" class="form-control" id="position" required>
          </div>
          <div class="form-group">
            <label for="company_name">Company Name:</label>
            <input type="text" class="form-control" id="company_name" required>
          </div>
          <button type="button" class="btn btn-primary" onclick="sendEmail()">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  var selectedButtonType = ''; // Variable to store the selected button type

  function setButtonType(buttonType) {
    selectedButtonType = buttonType;
  }

  function sendEmail() {
    var email = document.getElementById("email").value;
    var position = document.getElementById("position").value;
    var company_name=document.getElementById("company_name").value;

  if (selectedButtonType && email && position && company_name) {
      // Send email and position data to the backend
      fetch('/send-email/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
          email: email,
          position: position,
          company_name:company_name,
          buttonType: selectedButtonType
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
      // Show a success message to the user using SweetAlert
      Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: `Email sent successfully! Candidate ${selectedButtonType === 'select' ? 'selected' : 'rejected'}.`,
      })
      .then(() => {
        // Close the modal after successful submission
        $('#emailPositionModal').modal('hide');
        // Reload the page after successful submission
        window.location.reload();
      });
    } else {
          // Show an error message to the user
          Swal.fire({icon:'warning', text: 'Failed to send email. Please try again.'});
        }
      })
      .catch(error => {
        console.error('Error:', error);
        // Show an error message to the user
        Swal.fire({icon:'error', text: 'Failed to send email. Please try again.'});
      });
    } else {
      // Show a validation error if any of the fields are empty
      Swal.fire( {icon:'error', text:" Email, Position, and Company name are required!"});
    }
  }
</script>

{% endblock %}